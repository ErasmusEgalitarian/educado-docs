name: CI
on: pull_request
jobs:
  ci:
    name: CI
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5
      - name: Check If Versions Changed
        uses: dorny/paths-filter@v3
        id: changes
        with:
          filters: |
            changelog:
              - CHANGELOG.md
            pyproject:
              - pyproject.toml
      - name: Require both CHANGELOG.md and pyproject.toml changed
        if: ${{ steps.changes.outputs.changelog != 'true' || steps.changes.outputs.pyproject != 'true' }}
        run: |
          if [ "${{ steps.changes.outputs.changelog }}" != "true" ]; then
            echo "::error file=CHANGELOG.md::The changelog must be updated in every PR"
          fi

          if [ "${{ steps.changes.outputs.pyproject }}" != "true" ]; then
            echo "::error file=pyproject.toml::The pyproject.toml file must be updated in every PR"
          fi

          exit 1
      - name: Set Up uv
        uses: astral-sh/setup-uv@v6
        with:
          enable-cache: true
      - name: Install Python
        run: uv python install
      - name: Install Dependencies
        run: uv sync --frozen --all-extras
      - name: Run isort
        run: uv run isort --diff .
      - name: Run Black
        run: uv run black --diff .
      - name: Run ruff
        run: uv run ruff check
      - name: Run mypy
        run: uv run mypy
      - name: Run Pylint
        run: uv run pylint parse_files.py
      - name: Run Flake8
        run: uv run flake8 .
      - name: Parse CHANGELOG.md and pyproject.toml
        run: uv run parse_files.py
      - name: Build
        run: uv run mkdocs build --strict
